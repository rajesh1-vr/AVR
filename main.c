/*
 * LEDSCROLL7219.c
 *
 * Created: 7/3/2019 9:58:00 PM
 * Author : rajesh
 */ 
#define F_CPU 16000000U
#define maxic 2
#include<util/delay.h>
#include<avr/pgmspace.h>
//#include<avr/p>
#include <avr/io.h>
void output();
const char characters[96][5] PROGMEM = {
	{0b00000000,0b00000000,0b00000000,0b00000000,0b00000000}, // space
	{0b00000000,0b00000000,0b01001111,0b00000000,0b00000000}, // !
	{0b00000000,0b00000111,0b00000000,0b00000111,0b00000000}, // "
	{0b00010100,0b01111111,0b00010100,0b01111111,0b00010100}, // #
	{0b00100100,0b00101010,0b01111111,0b00101010,0b00010010}, // $
	{0b00100011,0b00010011,0b00001000,0b01100100,0b01100010}, // %
	{0b00110110,0b01001001,0b01010101,0b00100010,0b01010000}, // &
	{0b00000000,0b00000101,0b00000011,0b00000000,0b00000000}, // '
	{0b00000000,0b00011100,0b00100010,0b01000001,0b00000000}, // (
	{0b00000000,0b01000001,0b00100010,0b00011100,0b00000000}, // )
	{0b00010100,0b00001000,0b00111110,0b00001000,0b00010100}, // *
	{0b00001000,0b00001000,0b00111110,0b00001000,0b00001000}, // +
	{0b00000000,0b01010000,0b00110000,0b00000000,0b00000000}, // ,
	{0b00001000,0b00001000,0b00001000,0b00001000,0b00001000}, // -
	{0b00000000,0b01100000,0b01100000,0b00000000,0b00000000}, // .
	{0b00100000,0b00010000,0b00001000,0b00000100,0b00000010}, // /
	{0b00111110,0b01010001,0b01001001,0b01000101,0b00111110}, // 0
	{0b00000000,0b01000010,0b01111111,0b01000000,0b00000000}, // 1
	{0b01000010,0b01100001,0b01010001,0b01001001,0b01000110}, // 2
	{0b00100001,0b01000001,0b01000101,0b01001011,0b00110001}, // 3
	{0b00011000,0b00010100,0b00010010,0b01111111,0b00010000}, // 4
	{0b00100111,0b01000101,0b01000101,0b01000101,0b00111001}, // 5
	{0b00111100,0b01001010,0b01001001,0b01001001,0b00110000}, // 6
	{0b00000011,0b01110001,0b00001001,0b00000101,0b00000011}, // 7
	{0b00110110,0b01001001,0b01001001,0b01001001,0b00110110}, // 8
	{0b00000110,0b01001001,0b01001001,0b00101001,0b00011110}, // 9
	{0b00000000,0b01101100,0b01101100,0b00000000,0b00000000}, // :
	{0b00000000,0b01010110,0b00110110,0b00000000,0b00000000}, // ;
	{0b00001000,0b00010100,0b00100010,0b01000001,0b00000000}, // <
	{0b00010100,0b00010100,0b00010100,0b00010100,0b00010100}, // =
	{0b00000000,0b01000001,0b00100010,0b00010100,0b00001000}, // >
	{0b00000010,0b00000001,0b01010001,0b00001001,0b00000110}, // ?
	{0b00110010,0b01001001,0b01111001,0b01000001,0b00111110}, // @
	{0b01111110,0b00010001,0b00010001,0b00010001,0b01111110}, // A
	{0b01111111,0b01001001,0b01001001,0b01001001,0b00111110}, // B
	{0b00111110,0b01000001,0b01000001,0b01000001,0b00100010}, // C
	{0b01111111,0b01000001,0b01000001,0b01000001,0b00111110}, // D
	{0b01111111,0b01001001,0b01001001,0b01001001,0b01001001}, // E
	{0b01111111,0b00001001,0b00001001,0b00001001,0b00000001}, // F
	{0b00111110,0b01000001,0b01001001,0b01001001,0b00111010}, // G
	{0b01111111,0b00001000,0b00001000,0b00001000,0b01111111}, // H
	{0b01000001,0b01000001,0b01111111,0b01000001,0b01000001}, // I
	{0b00110000,0b01000001,0b01000001,0b00111111,0b00000001}, // J
	{0b01111111,0b00001000,0b00010100,0b00100010,0b01000001}, // K
	{0b01111111,0b01000000,0b01000000,0b01000000,0b01000000}, // L
	{0b01111111,0b00000010,0b00001100,0b00000010,0b01111111}, // M
	{0b01111111,0b00000100,0b00001000,0b00010000,0b01111111}, // N
	{0b00111110,0b01000001,0b01000001,0b01000001,0b00111110}, // O
	{0b01111111,0b00001001,0b00001001,0b00001001,0b00000110}, // P
	{0b00111110,0b01000001,0b01010001,0b00100001,0b01011110}, // Q
	{0b01111111,0b00001001,0b00001001,0b00011001,0b01100110}, // R
	{0b01000110,0b01001001,0b01001001,0b01001001,0b00110001}, // S
	{0b00000001,0b00000001,0b01111111,0b00000001,0b00000001}, // T
	{0b00111111,0b01000000,0b01000000,0b01000000,0b00111111}, // U
	{0b00001111,0b00110000,0b01000000,0b00110000,0b00001111}, // V
	{0b00111111,0b01000000,0b00111000,0b01000000,0b00111111}, // W
	{0b01100011,0b00010100,0b00001000,0b00010100,0b01100011}, // X
	{0b00000011,0b00000100,0b01111000,0b00000100,0b00000011}, // Y
	{0b01100001,0b01010001,0b01001001,0b01000101,0b01000011}, // Z
	{0b01111111,0b01000001,0b01000001,0b00000000,0b00000000}, // [
	{0b00000010,0b00000100,0b00001000,0b00010000,0b00100000}, // '\'
	{0b00000000,0b00000000,0b01000001,0b01000001,0b01111111}, // ]
	{0b00000100,0b00000010,0b00000001,0b00000010,0b00000100}, // ^
	{0b01000000,0b01000000,0b01000000,0b01000000,0b01000000}, // _
	{0b00000000,0b00000001,0b00000010,0b00000100,0b00000000}, // `
	{0b00100000,0b01010100,0b01010100,0b01010100,0b01111000}, // a
	{0b01111111,0b01001000,0b01000100,0b01000100,0b00111000}, // 0b
	{0b00111000,0b01000100,0b01000100,0b01000100,0b00100000}, // c
	{0b00111000,0b01000100,0b01000100,0b01001000,0b01111111}, // d
	{0b00111000,0b01010100,0b01010100,0b01010100,0b00011000}, // e
	{0b00001000,0b01111110,0b00001001,0b00000001,0b00000010}, // f
	{0b00001100,0b01010010,0b01010010,0b01010010,0b00111110}, // g
	{0b01111111,0b00001000,0b00000100,0b00000100,0b01111000}, // h
	{0b00000000,0b01000100,0b01111101,0b01000000,0b00000000}, // i
	{0b00100000,0b01000000,0b01000100,0b00111101,0b00000000}, // j
	{0b01111111,0b00010000,0b00101000,0b01000100,0b00000000}, // k
	{0b00000000,0b01000001,0b01111111,0b01000000,0b00000000}, // l
	{0b01111000,0b00000100,0b00001000,0b00000100,0b01111000}, // m
	{0b01111100,0b00001000,0b00000100,0b00000100,0b01111000}, // n
	{0b00111000,0b01000100,0b01000100,0b01000100,0b00111000}, // o
	{0b01111100,0b00010100,0b00010100,0b00010100,0b00001000}, // p
	{0b00001000,0b00010100,0b00010100,0b01111100,0b00000000}, // q
	{0b01111100,0b00001000,0b00000100,0b00000100,0b00001000}, // r
	{0b01001000,0b01010100,0b01010100,0b01010100,0b00100000}, // s
	{0b00000100,0b00111111,0b01000100,0b01000000,0b00100000}, // t
	{0b00111100,0b01000000,0b01000000,0b00100000,0b01111100}, // u
	{0b00011100,0b00100000,0b01000000,0b00100000,0b00011100}, // v
	{0b00111100,0b01000000,0b00110000,0b01000000,0b00111100}, // w
	{0b01000100,0b00101000,0b00010000,0b00101000,0b01000100}, // x
	{0b00001100,0b01010000,0b01010000,0b01010000,0b00111100}, // y
	{0b01000100,0b01100100,0b01010100,0b01001100,0b01000100}, // z
	{0b00000000,0b00001000,0b00110110,0b01000001,0b00000000}, // {
	{0b00000000,0b00000000,0b01111111,0b00000000,0b00000000}, // |
	{0b00000000,0b01000001,0b00110110,0b00001000,0b00000000}, // }
	{0b00001000,0b00000100,0b00000100,0b00001000,0b00000100} // ~
}; 
const char memory[] PROGMEM={"RK DENTO FACIAL CARE"};	
	
#define MOSI 5
#define SCK 7
#define SS 4
//#define F_CPU 12000000U
void display(unsigned char*,unsigned int );
void pushchar(unsigned char );
void pushbyte(unsigned char );
void Spi_Init(void);
void spi_tr(unsigned char cmd,unsigned char data);
static int ar[40]={0x7E,0x11,0x11,0x11,0x7E,0x00,0x00,0x00,0x10,0x28,0x44,0x44,0x7c,0x44,0x44,0x00,0x08,0x14,0x22,0x22,0x3e,0x22,0x22,0x00,0x04,0x0a,0x11,0x11,0x1f,0x11,0x11,0x00,0x20,0x05,0x99,0x99,0x8f,0x99,0x99,0x00};
	char t8,t1,t2,t3,t4,t5,t6,t7,i,j;
static int ar1[]={0x20,0x50,0x88,0x88,0xf8,0x88,0x88,0x00};
	
//int ar1[8]={0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08};
int main(void)
{
Spi_Init();

 spi_tr(0x0C,0x01);
  PORTB |=(1<<SS)|(1<<PORTB0);
  
 spi_tr(0x0A,0x0F);
  PORTB |=(1<<SS)|(1<<PORTB0);
 spi_tr(0x0B,0x07);
  PORTB |=(1<<SS)|(1<<PORTB0);
 spi_tr(0x09,0x00);
  PORTB |=(1<<SS)|(1<<PORTB0);
 
	
	const char *memorypointer=&memory[0];
	
	   /* Replace with your application code */
    while (1) 
    {
		
		display(memory,sizeof(memory));	
		pushbyte(0x00);
		}		  	
}




void Spi_Init()
{
	DDRB=(1<<MOSI)|(1<<SCK)|(1<<SS)|(1<<PORTB0);
	SPCR=(1<<SPE)|(1<<MSTR)|(1<<SPR0);
	
	
}

void spi_tr(unsigned char cmd,unsigned char data)
{
	
	PORTB &=~(1<<SS|(1<<PORTB0)); 
	        //enable transmission
	SPDR=cmd;                 // start transmission
	while(!(SPSR&(1<<SPIF))); // wait for complete transmission
	//PORTB |=(1<<SS); 
	//PORTB &=~(1<<SS);   
	SPDR=data;
	               // start trasmission
	while(!(SPSR&(1<<SPIF)));
	 // wait for transmission
	// PORTB |=(1<<SS);         // disable transmission
		
}

void pushbyte(unsigned char x)
{
for(unsigned char k=0;k<maxic*8-1;k++)
 
 {
	 
	 
	ar[k]=ar[k+1];
 }
	
	ar[maxic*8-1] =x;
	 
	 
 output();
	
	
}

void pushchar(unsigned char x)
{
for(unsigned char l=0;l<5;l++)
{
pushbyte(pgm_read_byte(&characters[x][l]));
	
}
	
	
}


void display(unsigned char * mem, unsigned int count)

{
for(i=0;i<count-1;i++)
{
pushchar(pgm_read_byte(mem+i)-32);	
pushbyte(0x00);

}



}







void output()


{
	/*
	 for(uint8_t n1 = 0; n1 < maxic; n1++) // For each cascaded device
	 {
		 for(uint8_t j1 = 1; j1 < 9; j1++) // For each column
		 {
			
			 
			 for(uint8_t k1 = 0; k1 < n1; k1++) // Write Pre No-Op code
			 spi_tr(0x00, 0x00);
			 
			 spi_tr(j1, ar[j1 + n1*8 - 1]); // Write column data from buffer
			 
			 for(uint8_t k2 = maxic-1; k2 > n1; k2--) // Write Post No-Op code
			 spi_tr(0x00, 0x00);
			 
			 PORTB|=(1<<SS);
		 }
	 }
	
	*/
	
	
	
	for(unsigned char z1=0;z1<maxic;z1++)//n1
	{
	
	for(unsigned char z2=1;z2<9;z2++){//j1
	
	for(unsigned char z3=0;z3<z1;z3++)
	spi_tr(0x00,0x00);
	

	spi_tr(z2,ar[z2+z1*8-1]);
	
	
	for(unsigned char z3=maxic-1;z3>z1;z3--)
	spi_tr(0x00,0x00);
	
	PORTB|=(1<<SS);	
	
	
	
	}
	
	}
	
	_delay_ms(50);
	
	
	
		
		}
	
